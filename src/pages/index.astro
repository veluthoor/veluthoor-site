---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');

const posts = allPosts
  .filter(p => p.data.status === 'published')
  .sort((a, b) => {
    const dateA = a.data.date ? new Date(a.data.date).getTime() : 0;
    const dateB = b.data.date ? new Date(b.data.date).getTime() : 0;
    return dateB - dateA;
  });

function formatDate(dateStr?: string) {
  if (!dateStr) return '';
  const d = new Date(dateStr);
  return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
}

function validImage(url?: string) {
  if (!url) return null;
  if (url.startsWith('__GHOST_URL__')) return null;
  return url;
}
---

<Layout title="Charu Veluthoor">
  <style>
    .intro {
      padding: 2rem 1.75rem 2.25rem;
      border-radius: 12px;
      background: linear-gradient(135deg, #fff5f0 0%, #f0f7fa 60%, #f5f0fb 100%);
      border: 1px solid var(--border);
      margin-bottom: 2.5rem;
    }

    .intro-header {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      margin-bottom: 1rem;
    }

    .avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      object-fit: cover;
      object-position: center top;
      flex-shrink: 0;
      border: 2px solid var(--border);
    }

    .intro h1 {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.2;
      margin: 0;
    }

    .intro p {
      font-size: 1rem;
      color: #444;
      line-height: 1.75;
      max-width: 560px;
      margin-bottom: 0.85rem;
    }

    .intro p:last-child { margin-bottom: 0; }

    .intro a {
      color: var(--accent);
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1.25rem;
    }

    .tag {
      font-size: 0.75rem;
      font-weight: 500;
      padding: 0.2rem 0.65rem;
      border-radius: 99px;
    }

    .tag-coral   { background: #fde8e0; color: #b83f18; }
    .tag-teal    { background: #ddf0f3; color: #1e6b7a; }
    .tag-purple  { background: #ede6f7; color: #5a3d8c; }
    .tag-green   { background: #e2f3e8; color: #2a7048; }
    .tag-yellow  { background: #fdf3d8; color: #7a5c00; }
    .tag-pink    { background: #fce8f0; color: #9c2a5a; }
    .tag-slate   { background: #e6edf5; color: #2e4e72; }

    /* Posts section */
    .posts-section h2 {
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.09em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 0.75rem;
    }

    .post-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    /* Posts WITH an image — card style */
    .post-item.has-image {
      border-bottom: 1px solid var(--border);
      padding: 0.75rem 0;
    }

    .post-item.has-image:first-of-type {
      border-top: 1px solid var(--border);
    }

    .post-card-link {
      display: flex;
      gap: 1rem;
      align-items: center;
      text-decoration: none;
      color: inherit;
    }

    .post-thumb {
      width: 64px;
      height: 64px;
      border-radius: 8px;
      object-fit: cover;
      flex-shrink: 0;
      background: var(--border);
    }

    .post-card-body {
      flex: 1;
      min-width: 0;
    }

    .post-card-title {
      font-size: 0.97rem;
      font-weight: 500;
      line-height: 1.4;
      margin-bottom: 0.2rem;
    }

    .post-card-date {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .post-card-link:hover .post-card-title {
      color: var(--accent);
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    /* Posts WITHOUT an image — simple list style */
    .post-item.no-image {
      padding: 0.9rem 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 1rem;
    }

    .post-item.no-image:first-of-type {
      border-top: 1px solid var(--border);
    }

    .post-title {
      font-size: 0.97rem;
      font-weight: 400;
      text-decoration: none;
      flex: 1;
    }

    .post-title:hover {
      color: var(--accent);
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    .post-date {
      font-size: 0.8rem;
      color: var(--muted);
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* Subscribe section */
    .subscribe-section {
      margin-bottom: 2.5rem;
      padding: 1.5rem 1.75rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fdf3ee;
    }

    .subscribe-section p {
      font-size: 0.9rem;
      color: #444;
      margin-bottom: 0.75rem;
    }

    .subscribe-form {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .subscribe-form input[type="email"] {
      flex: 1;
      min-width: 200px;
      height: 38px;
      padding: 0 0.75rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: #fff;
      font-size: 0.9rem;
      font-family: var(--font);
      outline: none;
      color: var(--text);
    }

    .subscribe-form input[type="email"]:focus {
      border-color: var(--accent);
    }

    .subscribe-form button {
      height: 38px;
      padding: 0 1.25rem;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      font-family: var(--font);
      font-weight: 500;
      cursor: pointer;
    }

    .subscribe-form button:hover {
      opacity: 0.88;
    }
  </style>

  <section class="intro">
    <div class="intro-header">
      <img src="/avatar.jpg" alt="Charu Veluthoor" class="avatar" />
      <h1>Hi, I'm Charu Veluthoor.</h1>
    </div>
    <p>
      I'm a 23 year old figuring out life. I use this space to mostly jot down my random thoughts.
      For the most part you can find me doing outdoorsy things and playing a lot of sport. I also
      enjoy travel, reading, a bit of hosting and being very dramatic about things nobody really
      cares about.
    </p>
    <p>More about me <a href="/about">here</a> :)</p>
    <div class="tags">
      <span class="tag tag-coral">travel</span>
      <span class="tag tag-teal">running</span>
      <span class="tag tag-yellow">food</span>
      <span class="tag tag-green">life in bangalore</span>
      <span class="tag tag-slate">personal finance</span>
      <span class="tag tag-purple">books</span>
      <span class="tag tag-pink">languages</span>
      <span class="tag tag-green">vibe coding</span>
    </div>
  </section>

  <section class="subscribe-section">
    <p>Get new posts in your inbox — no spam, just writing.</p>
    <form class="subscribe-form" action="https://api.follow.it/subscription-form/UW55STg3OG5VbmpKMWRNZVB3ajA5SjR4KzdDaUU2WEhHbldyOFRWczBMd2VUeHRFb2FWdmpRK2tVdVNjUGVoVkl6VW5vYjlnYU4ySUNZZlF6Z29zMytva05aZWRWVkdMbndHMFdJVGovME9vOVhpUkF6RDl4SHNiN0FHMFU4dmx8ZFFyNTM5UmVmQ2RWOTNSRnludC9iRTk5cWV3RTN1UVl3TFE2V0RkcXNwQT0=/8" method="post">
      <input type="email" name="email" required placeholder="your@email.com" />
      <button type="submit">Subscribe</button>
    </form>
  </section>

  <section class="posts-section">
    <h2>All posts</h2>
    <ul class="post-list">
      {posts.map(post => {
        const img = validImage(post.data.feature_image);
        return img ? (
          <li class="post-item has-image">
            <a href={`/blog/${post.id}`} class="post-card-link">
              <img src={img} alt={post.data.title} class="post-thumb" />
              <div class="post-card-body">
                <div class="post-card-title">{post.data.title}</div>
                <div class="post-card-date">{formatDate(post.data.date)}</div>
              </div>
            </a>
          </li>
        ) : (
          <li class="post-item no-image">
            <a href={`/blog/${post.id}`} class="post-title">{post.data.title}</a>
            <span class="post-date">{formatDate(post.data.date)}</span>
          </li>
        );
      })}
    </ul>
  </section>
</Layout>
